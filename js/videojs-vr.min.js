/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/videojs-vr@1.8.0/dist/videojs-vr.cjs.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*! @name videojs-vr @version 1.8.0 @license Apache-2.0 */
"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var _assertThisInitialized=_interopDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inheritsLoose=_interopDefault(require("@babel/runtime/helpers/inheritsLoose")),window$1=_interopDefault(require("global/window")),document$1=_interopDefault(require("global/document")),WebVRPolyfill=_interopDefault(require("webvr-polyfill")),videojs=_interopDefault(require("video.js")),THREE=require("three"),version="1.8.0",VRControls=function(e,t){var i,n,o=this,r=new THREE.Matrix4,a=null;"VRFrameData"in window&&(a=new VRFrameData),navigator.getVRDisplays&&navigator.getVRDisplays().then((function(e){n=e,e.length>0?i=e[0]:t&&t("VR input not available.")})).catch((function(){console.warn("VRControls: Unable to get VR Displays")})),this.scale=1,this.standing=!1,this.userHeight=1.6,this.getVRDisplay=function(){return i},this.setVRDisplay=function(e){i=e},this.getVRDisplays=function(){return console.warn("VRControls: getVRDisplays() is being deprecated."),n},this.getStandingMatrix=function(){return r},this.update=function(){var t;i&&(i.getFrameData?(i.getFrameData(a),t=a.pose):i.getPose&&(t=i.getPose()),null!==t.orientation&&e.quaternion.fromArray(t.orientation),null!==t.position?e.position.fromArray(t.position):e.position.set(0,0,0),this.standing&&(i.stageParameters?(e.updateMatrix(),r.fromArray(i.stageParameters.sittingToStandingTransform),e.applyMatrix(r)):e.position.setY(e.position.y+this.userHeight)),e.position.multiplyScalar(o.scale))},this.dispose=function(){i=null}},VREffect=function(e,t){var i,n,o,r,a=new THREE.Vector3,s=new THREE.Vector3,c=new THREE.Matrix4,l=new THREE.Matrix4,h=new THREE.Matrix4,d=null;"VRFrameData"in window&&(d=new window.VRFrameData),navigator.getVRDisplays&&navigator.getVRDisplays().then((function(e){n=e,e.length>0?i=e[0]:t&&t("HMD not available")})).catch((function(){console.warn("VREffect: Unable to get VR Displays")})),this.isPresenting=!1;var u=this,v=e.getSize(),p=!1,m=e.getPixelRatio();this.getVRDisplay=function(){return i},this.setVRDisplay=function(e){i=e},this.getVRDisplays=function(){return console.warn("VREffect: getVRDisplays() is being deprecated."),n},this.setSize=function(t,n,o){if(v={width:t,height:n},p=o,u.isPresenting){var r=i.getEyeParameters("left");e.setPixelRatio(1),e.setSize(2*r.renderWidth,r.renderHeight,!1)}else e.setPixelRatio(m),e.setSize(t,n,o)};var E=e.domElement,f=[0,0,.5,1],y=[.5,0,.5,1];function g(){var t=u.isPresenting;if(u.isPresenting=void 0!==i&&i.isPresenting,u.isPresenting){var n=i.getEyeParameters("left"),o=n.renderWidth,r=n.renderHeight;t||(m=e.getPixelRatio(),v=e.getSize(),e.setPixelRatio(1),e.setSize(2*o,r,!1))}else t&&(e.setPixelRatio(m),e.setSize(v.width,v.height,p))}window.addEventListener("vrdisplaypresentchange",g,!1),this.setFullScreen=function(e){return new Promise((function(t,n){void 0!==i?u.isPresenting!==e?t(e?i.requestPresent([{source:E}]):i.exitPresent()):t():n(new Error("No VR hardware found."))}))},this.requestPresent=function(){return this.setFullScreen(!0)},this.exitPresent=function(){return this.setFullScreen(!1)},this.requestAnimationFrame=function(e){return void 0!==i?i.requestAnimationFrame(e):window.requestAnimationFrame(e)},this.cancelAnimationFrame=function(e){void 0!==i?i.cancelAnimationFrame(e):window.cancelAnimationFrame(e)},this.submitFrame=function(){void 0!==i&&u.isPresenting&&i.submitFrame()},this.autoSubmitFrame=!0;var w=new THREE.PerspectiveCamera;w.layers.enable(1);var b=new THREE.PerspectiveCamera;b.layers.enable(2),this.render=function(t,n,v,p){if(i&&u.isPresenting){var m=t.autoUpdate;m&&(t.updateMatrixWorld(),t.autoUpdate=!1),Array.isArray(t)&&(console.warn("VREffect.render() no longer supports arrays. Use object.layers instead."),t=t[0]);var E,g,V=e.getSize(),P=i.getLayers();if(P.length){var H=P[0];E=null!==H.leftBounds&&4===H.leftBounds.length?H.leftBounds:f,g=null!==H.rightBounds&&4===H.rightBounds.length?H.rightBounds:y}else E=f,g=y;if(o={x:Math.round(V.width*E[0]),y:Math.round(V.height*E[1]),width:Math.round(V.width*E[2]),height:Math.round(V.height*E[3])},r={x:Math.round(V.width*g[0]),y:Math.round(V.height*g[1]),width:Math.round(V.width*g[2]),height:Math.round(V.height*g[3])},v?(e.setRenderTarget(v),v.scissorTest=!0):(e.setRenderTarget(null),e.setScissorTest(!0)),(e.autoClear||p)&&e.clear(),null===n.parent&&n.updateMatrixWorld(),n.matrixWorld.decompose(w.position,w.quaternion,w.scale),b.position.copy(w.position),b.quaternion.copy(w.quaternion),b.scale.copy(w.scale),i.getFrameData)i.depthNear=n.near,i.depthFar=n.far,i.getFrameData(d),w.projectionMatrix.elements=d.leftProjectionMatrix,b.projectionMatrix.elements=d.rightProjectionMatrix,function(e){e.pose.orientation?(_.fromArray(e.pose.orientation),c.makeRotationFromQuaternion(_)):c.identity();e.pose.position&&(T.fromArray(e.pose.position),c.setPosition(T));l.fromArray(e.leftViewMatrix),l.multiply(c),h.fromArray(e.rightViewMatrix),h.multiply(c),l.getInverse(l),h.getInverse(h)}(d),w.updateMatrix(),w.matrix.multiply(l),w.matrix.decompose(w.position,w.quaternion,w.scale),b.updateMatrix(),b.matrix.multiply(h),b.matrix.decompose(b.position,b.quaternion,b.scale);else{var M=i.getEyeParameters("left"),x=i.getEyeParameters("right");w.projectionMatrix=R(M.fieldOfView,!0,n.near,n.far),b.projectionMatrix=R(x.fieldOfView,!0,n.near,n.far),a.fromArray(M.offset),s.fromArray(x.offset),w.translateOnAxis(a,w.scale.x),b.translateOnAxis(s,b.scale.x)}return v?(v.viewport.set(o.x,o.y,o.width,o.height),v.scissor.set(o.x,o.y,o.width,o.height)):(e.setViewport(o.x,o.y,o.width,o.height),e.setScissor(o.x,o.y,o.width,o.height)),e.render(t,w,v,p),v?(v.viewport.set(r.x,r.y,r.width,r.height),v.scissor.set(r.x,r.y,r.width,r.height)):(e.setViewport(r.x,r.y,r.width,r.height),e.setScissor(r.x,r.y,r.width,r.height)),e.render(t,b,v,p),v?(v.viewport.set(0,0,V.width,V.height),v.scissor.set(0,0,V.width,V.height),v.scissorTest=!1,e.setRenderTarget(null)):(e.setViewport(0,0,V.width,V.height),e.setScissorTest(!1)),m&&(t.autoUpdate=!0),void(u.autoSubmitFrame&&u.submitFrame())}e.render(t,n,v,p)},this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",g,!1)};var _=new THREE.Quaternion,T=new THREE.Vector3;function R(e,t,i,n){var o=Math.PI/180;return function(e,t,i,n){i=void 0===i?.01:i,n=void 0===n?1e4:n;var o=(t=void 0===t||t)?-1:1,r=new THREE.Matrix4,a=r.elements,s=function(e){var t=2/(e.leftTan+e.rightTan),i=(e.leftTan-e.rightTan)*t*.5,n=2/(e.upTan+e.downTan);return{scale:[t,n],offset:[i,(e.upTan-e.downTan)*n*.5]}}(e);return a[0]=s.scale[0],a[1]=0,a[2]=s.offset[0]*o,a[3]=0,a[4]=0,a[5]=s.scale[1],a[6]=-s.offset[1]*o,a[7]=0,a[8]=0,a[9]=0,a[10]=n/(i-n)*-o,a[11]=n*i/(i-n),a[12]=0,a[13]=0,a[14]=o,a[15]=0,r.transpose(),r}({upTan:Math.tan(e.upDegrees*o),downTan:Math.tan(e.downDegrees*o),leftTan:Math.tan(e.leftDegrees*o),rightTan:Math.tan(e.rightDegrees*o)},t,i,n)}},OrbitControls=function(e,t){var i,n,o,r,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return p.phi},this.getAzimuthalAngle=function(){return p.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),u=d.NONE},this.update=(i=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),o=n.clone().inverse(),r=new THREE.Vector3,a=new THREE.Quaternion,function(){var e=s.object.position;return i.copy(e).sub(s.target),i.applyQuaternion(n),p.setFromVector3(i),s.autoRotate&&u===d.NONE&&s.rotateLeft(2*Math.PI/60/60*s.autoRotateSpeed),p.theta+=m.theta,p.phi+=m.phi,p.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,p.theta)),p.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,p.phi)),p.makeSafe(),p.radius*=E,p.radius=Math.max(s.minDistance,Math.min(s.maxDistance,p.radius)),s.target.add(f),i.setFromSpherical(p),i.applyQuaternion(o),e.copy(s.target).add(i),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,f.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),f.set(0,0,0)),E=1,!!(y||r.distanceToSquared(s.object.position)>v||8*(1-a.dot(s.object.quaternion))>v)&&(s.dispatchEvent(c),r.copy(s.object.position),a.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",G,!1),s.domElement.removeEventListener("mousedown",A,!1),s.domElement.removeEventListener("wheel",B,!1),s.domElement.removeEventListener("touchstart",z,!1),s.domElement.removeEventListener("touchend",N,!1),s.domElement.removeEventListener("touchmove",F,!1),document.removeEventListener("mousemove",L,!1),document.removeEventListener("mouseup",I,!1),window.removeEventListener("keydown",U,!1)};var s=this,c={type:"change"},l={type:"start"},h={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},u=d.NONE,v=1e-6,p=new THREE.Spherical,m=new THREE.Spherical,E=1,f=new THREE.Vector3,y=!1,g=new THREE.Vector2,w=new THREE.Vector2,b=new THREE.Vector2,_=new THREE.Vector2,T=new THREE.Vector2,R=new THREE.Vector2,V=new THREE.Vector2,P=new THREE.Vector2,H=new THREE.Vector2;function M(){return Math.pow(.95,s.zoomSpeed)}s.rotateLeft=function(e){m.theta-=e},s.rotateUp=function(e){m.phi-=e};var x,S=(x=new THREE.Vector3,function(e,t){x.setFromMatrixColumn(t,0),x.multiplyScalar(-e),f.add(x)}),C=function(){var e=new THREE.Vector3;return function(t,i){!0===s.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),f.add(e)}}(),j=function(){var e=new THREE.Vector3;return function(t,i){var n=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var o=s.object.position;e.copy(o).sub(s.target);var r=e.length();r*=Math.tan(s.object.fov/2*Math.PI/180),S(2*t*r/n.clientHeight,s.object.matrix),C(2*i*r/n.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(S(t*(s.object.right-s.object.left)/s.object.zoom/n.clientWidth,s.object.matrix),C(i*(s.object.top-s.object.bottom)/s.object.zoom/n.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function D(e){s.object.isPerspectiveCamera?E/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function O(e){s.object.isPerspectiveCamera?E*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function A(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.ORBIT:if(!1===s.enableRotate)return;!function(e){g.set(e.clientX,e.clientY)}(e),u=d.ROTATE;break;case s.mouseButtons.ZOOM:if(!1===s.enableZoom)return;!function(e){V.set(e.clientX,e.clientY)}(e),u=d.DOLLY;break;case s.mouseButtons.PAN:if(!1===s.enablePan)return;!function(e){_.set(e.clientX,e.clientY)}(e),u=d.PAN}u!==d.NONE&&(document.addEventListener("mousemove",L,!1),document.addEventListener("mouseup",I,!1),s.dispatchEvent(l))}}function L(e){if(!1!==s.enabled)switch(e.preventDefault(),u){case d.ROTATE:if(!1===s.enableRotate)return;!function(e){w.set(e.clientX,e.clientY),b.subVectors(w,g).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;s.rotateLeft(2*Math.PI*b.x/t.clientHeight),s.rotateUp(2*Math.PI*b.y/t.clientHeight),g.copy(w),s.update()}(e);break;case d.DOLLY:if(!1===s.enableZoom)return;!function(e){P.set(e.clientX,e.clientY),H.subVectors(P,V),H.y>0?D(M()):H.y<0&&O(M()),V.copy(P),s.update()}(e);break;case d.PAN:if(!1===s.enablePan)return;!function(e){T.set(e.clientX,e.clientY),R.subVectors(T,_).multiplyScalar(s.panSpeed),j(R.x,R.y),_.copy(T),s.update()}(e)}}function I(e){!1!==s.enabled&&(document.removeEventListener("mousemove",L,!1),document.removeEventListener("mouseup",I,!1),s.dispatchEvent(h),u=d.NONE)}function B(e){!1===s.enabled||!1===s.enableZoom||u!==d.NONE&&u!==d.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(l),function(e){e.deltaY<0?O(M()):e.deltaY>0&&D(M()),s.update()}(e),s.dispatchEvent(h))}function U(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:j(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:j(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:j(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:j(-s.keyPanSpeed,0),s.update()}}(e)}function z(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enableRotate)return;!function(e){g.set(e.touches[0].pageX,e.touches[0].pageY)}(e),u=d.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);V.set(0,n)}if(s.enablePan){var o=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(o,r)}}(e),u=d.TOUCH_DOLLY_PAN;break;default:u=d.NONE}u!==d.NONE&&s.dispatchEvent(l)}}function F(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(u!==d.TOUCH_ROTATE)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY),b.subVectors(w,g).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;s.rotateLeft(2*Math.PI*b.x/t.clientHeight),s.rotateUp(2*Math.PI*b.y/t.clientHeight),g.copy(w),s.update()}(e);break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(u!==d.TOUCH_DOLLY_PAN)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);P.set(0,n),H.set(0,Math.pow(P.y/V.y,s.zoomSpeed)),D(H.y),V.copy(P)}if(s.enablePan){var o=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);T.set(o,r),R.subVectors(T,_).multiplyScalar(s.panSpeed),j(R.x,R.y),_.copy(T)}s.update()}(e);break;default:u=d.NONE}}function N(e){!1!==s.enabled&&(s.dispatchEvent(h),u=d.NONE)}function G(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("mousedown",A,!1),s.domElement.addEventListener("wheel",B,!1),s.domElement.addEventListener("touchstart",z,!1),s.domElement.addEventListener("touchend",N,!1),s.domElement.addEventListener("touchmove",F,!1),window.addEventListener("keydown",U,!1),this.update()};OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),OrbitControls.prototype.constructor=OrbitControls,Object.defineProperties(OrbitControls.prototype,{center:{get:function(){return console.warn("OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var i,n,o,r,a=function(e){t.deviceOrientation=e},s=function(){t.screenOrientation=window.orientation||0},c=(i=new THREE.Vector3(0,0,1),n=new THREE.Euler,o=new THREE.Quaternion,r=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,a,s,c){n.set(a,t,-s,"YXZ"),e.setFromEuler(n),e.multiply(r),e.multiply(o.setFromAxisAngle(i,-c))});this.connect=function(){s(),window.addEventListener("orientationchange",s,!1),window.addEventListener("deviceorientation",a,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientation",a,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation;if(e){var i=e.alpha?THREE.Math.degToRad(e.alpha)+t.alphaOffset:0,n=e.beta?THREE.Math.degToRad(e.beta):0,o=e.gamma?THREE.Math.degToRad(e.gamma):0,r=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;c(t.object.quaternion,i,n,o,r)}}},this.dispose=function(){t.disconnect()},this.connect()};function Quat2Angle(e,t,i,n){var o=e*t+i*n;if(o>.499){var r=2*Math.atan2(e,n),a=Math.PI/2;return new THREE.Vector3(a,0,r)}if(o<-.499){var s=-2*Math.atan2(e,n),c=-Math.PI/2;return new THREE.Vector3(c,0,s)}var l=e*e,h=t*t,d=i*i,u=Math.atan2(2*t*n-2*e*i,1-2*h-2*d),v=Math.asin(2*o),p=Math.atan2(2*e*n-2*t*i,1-2*l-2*d);return new THREE.Vector3(v,p,u)}var OrbitOrientationControls=function(){function e(e){this.object=e.camera,this.domElement=e.canvas,this.orbit=new OrbitControls(this.object,this.domElement),this.speed=.5,this.orbit.target.set(0,0,-1),this.orbit.enableZoom=!1,this.orbit.enablePan=!1,this.orbit.rotateSpeed=-this.speed,e.orientation&&(this.orientation=new DeviceOrientationControls(this.object)),e.halfView&&(this.orbit.minAzimuthAngle=-Math.PI/4,this.orbit.maxAzimuthAngle=Math.PI/4)}var t=e.prototype;return t.update=function(){if(this.orientation){this.orientation.update();var e=this.orientation.object.quaternion,t=Quat2Angle(e.x,e.y,e.z,e.w);void 0===this.lastAngle_&&(this.lastAngle_=t),this.orbit.rotateLeft((this.lastAngle_.z-t.z)*(1+this.speed)),this.orbit.rotateUp((this.lastAngle_.y-t.y)*(1+this.speed)),this.lastAngle_=t}this.orbit.update()},t.dispose=function(){this.orbit.dispose(),this.orientation&&this.orientation.dispose()},e}(),corsSupport=function(){var e=document$1.createElement("video");return e.crossOrigin="anonymous",e.hasAttribute("crossorigin")}(),validProjections=["360","360_LR","360_TB","360_CUBE","EAC","EAC_LR","NONE","AUTO","Sphere","Cube","equirectangular","180","180_LR","180_MONO"],getInternalProjectionName=function(e){if(e){if(e=e.toString().trim(),/sphere/i.test(e))return"360";if(/cube/i.test(e))return"360_CUBE";if(/equirectangular/i.test(e))return"360";for(var t=0;t<validProjections.length;t++)if(new RegExp("^"+validProjections[t]+"$","i").test(e))return validProjections[t]}},CanvasPlayerControls=function(e){function t(t,i,n){var o;return(o=e.call(this)||this).player=t,o.canvas=i,o.options=n,o.onMoveEnd=videojs.bind(_assertThisInitialized(o),o.onMoveEnd),o.onMoveStart=videojs.bind(_assertThisInitialized(o),o.onMoveStart),o.onMove=videojs.bind(_assertThisInitialized(o),o.onMove),o.onControlBarMove=videojs.bind(_assertThisInitialized(o),o.onControlBarMove),o.player.controlBar.on(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"],o.onControlBarMove),o.oldReportUserActivity=o.player.reportUserActivity,o.player.reportUserActivity=function(){},o.canvas.addEventListener("mousedown",o.onMoveStart),o.canvas.addEventListener("touchstart",o.onMoveStart),o.canvas.addEventListener("mousemove",o.onMove),o.canvas.addEventListener("touchmove",o.onMove),o.canvas.addEventListener("mouseup",o.onMoveEnd),o.canvas.addEventListener("touchend",o.onMoveEnd),o.shouldTogglePlay=!1,o}_inheritsLoose(t,e);var i=t.prototype;return i.togglePlay=function(){this.player.paused()?this.player.play():this.player.pause()},i.onMoveStart=function(e){this.options.disableTogglePlay||!this.player.controls()||"mousedown"===e.type&&!videojs.dom.isSingleLeftClick(e)?this.shouldTogglePlay=!1:(this.shouldTogglePlay=!0,this.touchMoveCount_=0)},i.onMoveEnd=function(e){if("touchend"===e.type&&this.touchMoveCount_<10)return!1===this.player.userActive()?void this.player.userActive(!0):void this.player.userActive(!1);this.shouldTogglePlay&&"mouseup"==e.type&&this.togglePlay()},i.onMove=function(e){this.touchMoveCount_++,this.shouldTogglePlay=!1},i.onControlBarMove=function(e){this.player.userActive(!0)},i.dispose=function(){this.canvas.removeEventListener("mousedown",this.onMoveStart),this.canvas.removeEventListener("touchstart",this.onMoveStart),this.canvas.removeEventListener("mousemove",this.onMove),this.canvas.removeEventListener("touchmove",this.onMove),this.canvas.removeEventListener("mouseup",this.onMoveEnd),this.canvas.removeEventListener("touchend",this.onMoveEnd),this.player.controlBar.off(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"],this.onControlBarMove),this.player.reportUserActivity=this.oldReportUserActivity},t}(videojs.EventTarget),OmnitoneController=function(e){function t(t,i,n,o){var r;r=e.call(this)||this;var a=videojs.mergeOptions({channelMap:videojs.browser.IS_SAFARI?[2,0,1,3]:[0,1,2,3],ambisonicOrder:1},o);return r.videoElementSource=t.createMediaElementSource(n),r.foaRenderer=i.createFOARenderer(t,a),r.foaRenderer.initialize().then((function(){"suspended"===t.state&&r.trigger({type:"audiocontext-suspended"}),r.videoElementSource.connect(r.foaRenderer.input),r.foaRenderer.output.connect(t.destination),r.initialized=!0,r.trigger({type:"omnitone-ready"})}),(function(e){videojs.log.warn("videojs-vr: Omnitone initializes failed with the following error: "+e+")")})),r}_inheritsLoose(t,e);var i=t.prototype;return i.update=function(e){this.initialized&&this.foaRenderer.setRotationMatrixFromCamera(e.matrix)},i.dispose=function(){this.initialized=!1,this.foaRenderer.setRenderingMode("bypass"),this.foaRenderer=null},t}(videojs.EventTarget),Button=videojs.getComponent("Button"),CardboardButton=function(e){function t(t,i){var n;return(n=e.call(this,t,i)||this).handleVrDisplayActivate_=videojs.bind(_assertThisInitialized(n),n.handleVrDisplayActivate_),n.handleVrDisplayDeactivate_=videojs.bind(_assertThisInitialized(n),n.handleVrDisplayDeactivate_),n.handleVrDisplayPresentChange_=videojs.bind(_assertThisInitialized(n),n.handleVrDisplayPresentChange_),n.handleOrientationChange_=videojs.bind(_assertThisInitialized(n),n.handleOrientationChange_),window$1.addEventListener("orientationchange",n.handleOrientationChange_),window$1.addEventListener("vrdisplayactivate",n.handleVrDisplayActivate_),window$1.addEventListener("vrdisplaydeactivate",n.handleVrDisplayDeactivate_),window$1.addEventListener("vrdisplaypresentchange",n.handleVrDisplayPresentChange_),videojs.browser.IS_ANDROID&&n.on(t,"fullscreenchange",(function(){t.isFullscreen()?n.hide():n.show()})),n}_inheritsLoose(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-button-vr "+e.prototype.buildCSSClass.call(this)},i.handleVrDisplayPresentChange_=function(){!this.player_.vr().vrDisplay.isPresenting&&this.active_&&this.handleVrDisplayDeactivate_(),this.player_.vr().vrDisplay.isPresenting&&!this.active_&&this.handleVrDisplayActivate_()},i.handleOrientationChange_=function(){this.active_&&videojs.browser.IS_IOS&&this.changeSize_()},i.changeSize_=function(){this.player_.width(window$1.innerWidth),this.player_.height(window$1.innerHeight),window$1.dispatchEvent(new window$1.Event("resize"))},i.handleVrDisplayActivate_=function(){videojs.browser.IS_IOS&&(this.oldWidth_=this.player_.currentWidth(),this.oldHeight_=this.player_.currentHeight(),this.player_.enterFullWindow(),this.changeSize_()),this.active_=!0},i.handleVrDisplayDeactivate_=function(){videojs.browser.IS_IOS&&(this.oldWidth_&&this.player_.width(this.oldWidth_),this.oldHeight_&&this.player_.height(this.oldHeight_),this.player_.exitFullWindow()),this.active_=!1},i.handleClick=function(e){this.active_?window$1.dispatchEvent(new window$1.Event("vrdisplaydeactivate")):(!this.player_.hasStarted()&&videojs.browser.IS_ANDROID&&this.player_.play(),window$1.dispatchEvent(new window$1.Event("vrdisplayactivate")))},i.dispose=function(){e.prototype.dispose.call(this),window$1.removeEventListener("vrdisplayactivate",this.handleVrDisplayActivate_),window$1.removeEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_),window$1.removeEventListener("vrdisplaypresentchange",this.handleVrDisplayPresentChange_)},t}(Button);videojs.registerComponent("CardboardButton",CardboardButton);var BigPlayButton=videojs.getComponent("BigPlayButton"),BigVrPlayButton=function(e){function t(){return e.apply(this,arguments)||this}return _inheritsLoose(t,e),t.prototype.buildCSSClass=function(){return"vjs-big-vr-play-button "+e.prototype.buildCSSClass.call(this)},t}(BigPlayButton);function _createForOfIteratorHelperLoose(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}videojs.registerComponent("BigVrPlayButton",BigVrPlayButton);var defaults={debug:!1,omnitone:!1,forceCardboard:!1,omnitoneOptions:{},projection:"AUTO",sphereDetail:32,disableTogglePlay:!1},errors={"web-vr-out-of-date":{headline:"360 is out of date",type:"360_OUT_OF_DATE",message:"Your browser supports 360 but not the latest version. See <a href='http://webvr.info'>http://webvr.info</a> for more info."},"web-vr-not-supported":{headline:"360 not supported on this device",type:"360_NOT_SUPPORTED",message:"Your browser does not support 360. See <a href='http://webvr.info'>http://webvr.info</a> for assistance."},"web-vr-hls-cors-not-supported":{headline:"360 HLS video not supported on this device",type:"360_NOT_SUPPORTED",message:"Your browser/device does not support HLS 360 video. See <a href='http://webvr.info'>http://webvr.info</a> for assistance."}},Plugin=videojs.getPlugin("plugin"),Component=videojs.getComponent("Component"),VR=function(e){function t(t,i){var n,o=videojs.mergeOptions(defaults,i);return(n=e.call(this,t,o)||this).options_=o,n.player_=t,n.bigPlayButtonIndex_=t.children().indexOf(t.getChild("BigPlayButton"))||0,n.videojsErrorsSupport_=!!videojs.errors,n.videojsErrorsSupport_&&t.errors({errors:errors}),videojs.browser.IE_VERSION||!corsSupport?(n.player_.on("loadstart",(function(){n.triggerError_({code:"web-vr-not-supported",dismiss:!1})})),_assertThisInitialized(n)):(n.polyfill_=new WebVRPolyfill({ROTATE_INSTRUCTIONS_DISABLED:!0}),n.polyfill_=new WebVRPolyfill,n.handleVrDisplayActivate_=videojs.bind(_assertThisInitialized(n),n.handleVrDisplayActivate_),n.handleVrDisplayDeactivate_=videojs.bind(_assertThisInitialized(n),n.handleVrDisplayDeactivate_),n.handleResize_=videojs.bind(_assertThisInitialized(n),n.handleResize_),n.animate_=videojs.bind(_assertThisInitialized(n),n.animate_),n.setProjection(n.options_.projection),n.on(t,"adstart",(function(){return t.setTimeout((function(){t.ads&&t.ads.videoElementRecycled()?(n.log("video element recycled for this ad, reseting"),n.reset(),n.one(t,"playing",n.init)):n.log("video element not recycled for this ad, no need to reset")}))}),1),n.on(t,"loadedmetadata",n.init),n)}_inheritsLoose(t,e);var i=t.prototype;return i.changeProjection_=function(e){var t=this;(e=getInternalProjectionName(e))||(e="NONE");var i=0,n=0,o=0;if(this.scene&&this.scene.remove(this.movieScreen),"AUTO"===e){if(this.player_.mediainfo&&this.player_.mediainfo.projection&&"AUTO"!==this.player_.mediainfo.projection){var r=getInternalProjectionName(this.player_.mediainfo.projection);return this.changeProjection_(r)}return this.changeProjection_("NONE")}if("360"===e)this.movieGeometry=new THREE.SphereBufferGeometry(256,this.options_.sphereDetail,this.options_.sphereDetail),this.movieMaterial=new THREE.MeshBasicMaterial({map:this.videoTexture,overdraw:!0,side:THREE.BackSide}),this.movieScreen=new THREE.Mesh(this.movieGeometry,this.movieMaterial),this.movieScreen.position.set(i,n,o),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.scene.add(this.movieScreen);else if("360_LR"===e||"360_TB"===e){for(var a=new THREE.SphereGeometry(256,this.options_.sphereDetail,this.options_.sphereDetail),s=a.faceVertexUvs[0],c=0;c<s.length;c++)for(var l=0;l<3;l++)"360_LR"===e?s[c][l].x*=.5:(s[c][l].y*=.5,s[c][l].y+=.5);this.movieGeometry=(new THREE.BufferGeometry).fromGeometry(a),this.movieMaterial=new THREE.MeshBasicMaterial({map:this.videoTexture,overdraw:!0,side:THREE.BackSide}),this.movieScreen=new THREE.Mesh(this.movieGeometry,this.movieMaterial),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),s=(a=new THREE.SphereGeometry(256,this.options_.sphereDetail,this.options_.sphereDetail)).faceVertexUvs[0];for(var h=0;h<s.length;h++)for(var d=0;d<3;d++)"360_LR"===e?(s[h][d].x*=.5,s[h][d].x+=.5):s[h][d].y*=.5;this.movieGeometry=(new THREE.BufferGeometry).fromGeometry(a),this.movieMaterial=new THREE.MeshBasicMaterial({map:this.videoTexture,overdraw:!0,side:THREE.BackSide}),this.movieScreen=new THREE.Mesh(this.movieGeometry,this.movieMaterial),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}else if("360_CUBE"===e){this.movieGeometry=new THREE.BoxGeometry(256,256,256),this.movieMaterial=new THREE.MeshBasicMaterial({map:this.videoTexture,overdraw:!0,side:THREE.BackSide});var u=[new THREE.Vector2(0,.5),new THREE.Vector2(.333,.5),new THREE.Vector2(.333,1),new THREE.Vector2(0,1)],v=[new THREE.Vector2(.333,.5),new THREE.Vector2(.666,.5),new THREE.Vector2(.666,1),new THREE.Vector2(.333,1)],p=[new THREE.Vector2(.666,.5),new THREE.Vector2(1,.5),new THREE.Vector2(1,1),new THREE.Vector2(.666,1)],m=[new THREE.Vector2(0,0),new THREE.Vector2(.333,0),new THREE.Vector2(.333,.5),new THREE.Vector2(0,.5)],E=[new THREE.Vector2(.333,0),new THREE.Vector2(.666,0),new THREE.Vector2(.666,.5),new THREE.Vector2(.333,.5)],f=[new THREE.Vector2(.666,0),new THREE.Vector2(1,0),new THREE.Vector2(1,.5),new THREE.Vector2(.666,.5)];this.movieGeometry.faceVertexUvs[0]=[],this.movieGeometry.faceVertexUvs[0][0]=[v[2],v[1],v[3]],this.movieGeometry.faceVertexUvs[0][1]=[v[1],v[0],v[3]],this.movieGeometry.faceVertexUvs[0][2]=[u[2],u[1],u[3]],this.movieGeometry.faceVertexUvs[0][3]=[u[1],u[0],u[3]],this.movieGeometry.faceVertexUvs[0][4]=[p[2],p[1],p[3]],this.movieGeometry.faceVertexUvs[0][5]=[p[1],p[0],p[3]],this.movieGeometry.faceVertexUvs[0][6]=[m[2],m[1],m[3]],this.movieGeometry.faceVertexUvs[0][7]=[m[1],m[0],m[3]],this.movieGeometry.faceVertexUvs[0][8]=[E[2],E[1],E[3]],this.movieGeometry.faceVertexUvs[0][9]=[E[1],E[0],E[3]],this.movieGeometry.faceVertexUvs[0][10]=[f[2],f[1],f[3]],this.movieGeometry.faceVertexUvs[0][11]=[f[1],f[0],f[3]],this.movieScreen=new THREE.Mesh(this.movieGeometry,this.movieMaterial),this.movieScreen.position.set(i,n,o),this.movieScreen.rotation.y=-Math.PI,this.scene.add(this.movieScreen)}else if("180"===e||"180_LR"===e||"180_MONO"===e){var y=new THREE.SphereGeometry(256,this.options_.sphereDetail,this.options_.sphereDetail,Math.PI,Math.PI);y.scale(-1,1,1);var g=y.faceVertexUvs[0];if("180_MONO"!==e)for(var w=0;w<g.length;w++)for(var b=0;b<3;b++)g[w][b].x*=.5;this.movieGeometry=(new THREE.BufferGeometry).fromGeometry(y),this.movieMaterial=new THREE.MeshBasicMaterial({map:this.videoTexture,overdraw:!0}),this.movieScreen=new THREE.Mesh(this.movieGeometry,this.movieMaterial),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),(y=new THREE.SphereGeometry(256,this.options_.sphereDetail,this.options_.sphereDetail,Math.PI,Math.PI)).scale(-1,1,1),g=y.faceVertexUvs[0];for(var _=0;_<g.length;_++)for(var T=0;T<3;T++)g[_][T].x*=.5,g[_][T].x+=.5;this.movieGeometry=(new THREE.BufferGeometry).fromGeometry(y),this.movieMaterial=new THREE.MeshBasicMaterial({map:this.videoTexture,overdraw:!0}),this.movieScreen=new THREE.Mesh(this.movieGeometry,this.movieMaterial),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}else if("EAC"===e||"EAC_LR"===e){var R=function(e,r){t.movieGeometry=new THREE.BoxGeometry(256,256,256),t.movieMaterial=new THREE.ShaderMaterial({overdraw:!0,side:THREE.BackSide,uniforms:{mapped:{value:t.videoTexture},mapMatrix:{value:e},contCorrect:{value:2},faceWH:{value:new THREE.Vector2(1/3,.5).applyMatrix3(r)},vidWH:{value:new THREE.Vector2(t.videoTexture.image.videoWidth,t.videoTexture.image.videoHeight).applyMatrix3(r)}},vertexShader:"\nvarying vec2 vUv;\nuniform mat3 mapMatrix;\n\nvoid main() {\n  vUv = (mapMatrix * vec3(uv, 1.)).xy;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);\n}",fragmentShader:"\nvarying vec2 vUv;\nuniform sampler2D mapped;\nuniform vec2 faceWH;\nuniform vec2 vidWH;\nuniform float contCorrect;\n\nconst float PI = 3.1415926535897932384626433832795;\n\nvoid main() {\n  vec2 corner = vUv - mod(vUv, faceWH) + vec2(0, contCorrect / vidWH.y);\n\n  vec2 faceWHadj = faceWH - vec2(0, contCorrect * 2. / vidWH.y);\n\n  vec2 p = (vUv - corner) / faceWHadj - .5;\n  vec2 q = 2. / PI * atan(2. * p) + .5;\n\n  vec2 eUv = corner + q * faceWHadj;\n\n  gl_FragColor = texture2D(mapped, eUv);\n}"});for(var a=[new THREE.Vector2(0,.5),new THREE.Vector2(1/3,.5),new THREE.Vector2(1/3,1),new THREE.Vector2(0,1)],s=[new THREE.Vector2(1/3,.5),new THREE.Vector2(2/3,.5),new THREE.Vector2(2/3,1),new THREE.Vector2(1/3,1)],c=[new THREE.Vector2(2/3,.5),new THREE.Vector2(1,.5),new THREE.Vector2(1,1),new THREE.Vector2(2/3,1)],l=[new THREE.Vector2(1/3,0),new THREE.Vector2(1/3,.5),new THREE.Vector2(0,.5),new THREE.Vector2(0,0)],h=[new THREE.Vector2(1/3,.5),new THREE.Vector2(1/3,0),new THREE.Vector2(2/3,0),new THREE.Vector2(2/3,.5)],d=[new THREE.Vector2(1,0),new THREE.Vector2(1,.5),new THREE.Vector2(2/3,.5),new THREE.Vector2(2/3,0)],u=0,v=[a,s,c,l,h,d];u<v.length;u++){for(var p,m=v[u],E=t.videoTexture.image.videoHeight,f=1,y=0,g=_createForOfIteratorHelperLoose(m);!(p=g()).done;){var w=p.value;w.y<f&&(f=w.y),w.y>y&&(y=w.y)}for(var b,_=_createForOfIteratorHelperLoose(m);!(b=_()).done;){var T=b.value;Math.abs(T.y-f)<Number.EPSILON&&(T.y+=2/E),Math.abs(T.y-y)<Number.EPSILON&&(T.y-=2/E),T.x=T.x/E*(E-4)+2/E}}return t.movieGeometry.faceVertexUvs[0]=[],t.movieGeometry.faceVertexUvs[0][0]=[a[2],a[1],a[3]],t.movieGeometry.faceVertexUvs[0][1]=[a[1],a[0],a[3]],t.movieGeometry.faceVertexUvs[0][2]=[c[2],c[1],c[3]],t.movieGeometry.faceVertexUvs[0][3]=[c[1],c[0],c[3]],t.movieGeometry.faceVertexUvs[0][4]=[d[2],d[1],d[3]],t.movieGeometry.faceVertexUvs[0][5]=[d[1],d[0],d[3]],t.movieGeometry.faceVertexUvs[0][6]=[l[2],l[1],l[3]],t.movieGeometry.faceVertexUvs[0][7]=[l[1],l[0],l[3]],t.movieGeometry.faceVertexUvs[0][8]=[s[2],s[1],s[3]],t.movieGeometry.faceVertexUvs[0][9]=[s[1],s[0],s[3]],t.movieGeometry.faceVertexUvs[0][10]=[h[2],h[1],h[3]],t.movieGeometry.faceVertexUvs[0][11]=[h[1],h[0],h[3]],t.movieScreen=new THREE.Mesh(t.movieGeometry,t.movieMaterial),t.movieScreen.position.set(i,n,o),t.movieScreen.rotation.y=-Math.PI,t.movieScreen};if("EAC"===e)this.scene.add(R(new THREE.Matrix3,new THREE.Matrix3));else{var V=(new THREE.Matrix3).set(0,.5,0,1,0,0,0,0,1);R((new THREE.Matrix3).set(0,-.5,.5,1,0,0,0,0,1),V),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),R((new THREE.Matrix3).set(0,-.5,1,1,0,0,0,0,1),V),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}}this.currentProjection_=e},i.triggerError_=function(e){if(this.videojsErrorsSupport_)this.player_.error(e);else{var t=document$1.createElement("div");t.innerHTML=errors[e.code].message;var i=t.textContent||t.innerText||"";this.player_.error({code:e.code,message:i})}},i.log=function(){if(this.options_.debug){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((function(e){videojs.log("VR: ",e)}))}},i.handleVrDisplayActivate_=function(){var e=this;this.vrDisplay&&this.vrDisplay.requestPresent([{source:this.renderedCanvas}]).then((function(){if(e.vrDisplay.cardboardUI_&&videojs.browser.IS_IOS){var t=[],i=function(e){for(var i=0;i<e.touches.length;i++)t.push(e.touches[i])},n=function(i){t.length&&(t.forEach((function(t){var i=new window$1.MouseEvent("click",{screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});e.renderedCanvas.dispatchEvent(i)})),t=[])};e.renderedCanvas.addEventListener("touchstart",i),e.renderedCanvas.addEventListener("touchend",n),e.iosRevertTouchToClick_=function(){e.renderedCanvas.removeEventListener("touchstart",i),e.renderedCanvas.removeEventListener("touchend",n),e.iosRevertTouchToClick_=null}}}))},i.handleVrDisplayDeactivate_=function(){this.vrDisplay&&this.vrDisplay.isPresenting&&(this.iosRevertTouchToClick_&&this.iosRevertTouchToClick_(),this.vrDisplay.exitPresent())},i.requestAnimationFrame=function(e){return this.vrDisplay?this.vrDisplay.requestAnimationFrame(e):this.player_.requestAnimationFrame(e)},i.cancelAnimationFrame=function(e){return this.vrDisplay?this.vrDisplay.cancelAnimationFrame(e):this.player_.cancelAnimationFrame(e)},i.togglePlay_=function(){this.player_.paused()?this.player_.play():this.player_.pause()},i.animate_=function(){if(this.initialized_){if(this.getVideoEl_().readyState===this.getVideoEl_().HAVE_ENOUGH_DATA&&this.videoTexture&&(this.videoTexture.needsUpdate=!0),this.controls3d.update(),this.omniController&&this.omniController.update(this.camera),this.effect.render(this.scene,this.camera),window$1.navigator.getGamepads)for(var e=window$1.navigator.getGamepads(),t=0;t<e.length;++t){var i=e[t];if(i&&i.timestamp&&i.timestamp!==this.prevTimestamps_[t])for(var n=0;n<i.buttons.length;++n)if(i.buttons[n].pressed){this.togglePlay_(),this.prevTimestamps_[t]=i.timestamp;break}}this.camera.getWorldDirection(this.cameraVector),this.animationFrameId_=this.requestAnimationFrame(this.animate_)}},i.handleResize_=function(){var e=this.player_.currentWidth(),t=this.player_.currentHeight();this.effect.setSize(e,t,!1),this.camera.aspect=e/t,this.camera.updateProjectionMatrix()},i.setProjection=function(e){getInternalProjectionName(e)?(this.currentProjection_=e,this.defaultProjection_=e):videojs.log.error("videojs-vr: please pass a valid projection "+validProjections.join(", "))},i.init=function(){var e=this;if(this.reset(),this.camera=new THREE.PerspectiveCamera(75,this.player_.currentWidth()/this.player_.currentHeight(),1,1e3),this.cameraVector=new THREE.Vector3,"360_LR"!==this.currentProjection_&&"360_TB"!==this.currentProjection_&&"180"!==this.currentProjection_&&"180_LR"!==this.currentProjection_&&"180_MONO"!==this.currentProjection_&&"EAC_LR"!==this.currentProjection_||this.camera.layers.enable(1),this.scene=new THREE.Scene,this.videoTexture=new THREE.VideoTexture(this.getVideoEl_()),this.videoTexture.generateMipmaps=!1,this.videoTexture.minFilter=THREE.LinearFilter,this.videoTexture.magFilter=THREE.LinearFilter,this.videoTexture.format=THREE.RGBFormat,this.changeProjection_(this.currentProjection_),"NONE"===this.currentProjection_)return this.log("Projection is NONE, dont init"),void this.reset();this.player_.removeChild("BigPlayButton"),this.player_.addChild("BigVrPlayButton",{},this.bigPlayButtonIndex_),this.player_.bigPlayButton=this.player_.getChild("BigVrPlayButton"),(this.options_.forceCardboard||videojs.browser.IS_ANDROID||videojs.browser.IS_IOS)&&this.addCardboardButton_(),videojs.browser.IS_IOS&&this.player_.controlBar&&this.player_.controlBar.fullscreenToggle&&this.player_.controlBar.fullscreenToggle.hide(),this.camera.position.set(0,0,0),this.renderer=new THREE.WebGLRenderer({devicePixelRatio:window$1.devicePixelRatio,alpha:!1,clearColor:16777215,antialias:!0});var t=this.renderer.getContext("webgl"),i=t.texImage2D;t.texImage2D=function(){try{for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return i.apply(t,o)}catch(t){throw e.reset(),e.player_.pause(),e.triggerError_({code:"web-vr-hls-cors-not-supported",dismiss:!1}),new Error(t)}},this.renderer.setSize(this.player_.currentWidth(),this.player_.currentHeight(),!1),this.effect=new VREffect(this.renderer),this.effect.setSize(this.player_.currentWidth(),this.player_.currentHeight(),!1),this.vrDisplay=null,this.prevTimestamps_=[],this.renderedCanvas=this.renderer.domElement,this.renderedCanvas.setAttribute("style","width: 100%; height: 100%; position: absolute; top:0;");var n=this.getVideoEl_().style;if(this.player_.el().insertBefore(this.renderedCanvas,this.player_.el().firstChild),n.zIndex="-1",n.opacity="0",window$1.navigator.getVRDisplays?(this.log("is supported, getting vr displays"),window$1.navigator.getVRDisplays().then((function(t){if(t.length>0&&(e.log("Displays found",t),e.vrDisplay=t[0],e.vrDisplay.isPolyfilled||(e.log("Real HMD found using VRControls",e.vrDisplay),e.addCardboardButton_(),e.controls3d=new VRControls(e.camera))),!e.controls3d){e.log("no HMD found Using Orbit & Orientation Controls");var i={camera:e.camera,canvas:e.renderedCanvas,halfView:0===e.currentProjection_.indexOf("180"),orientation:videojs.browser.IS_IOS||videojs.browser.IS_ANDROID||!1};!1===e.options_.motionControls&&(i.orientation=!1),e.controls3d=new OrbitOrientationControls(i),e.canvasPlayerControls=new CanvasPlayerControls(e.player_,e.renderedCanvas,e.options_)}e.animationFrameId_=e.requestAnimationFrame(e.animate_)}))):window$1.navigator.getVRDevices?this.triggerError_({code:"web-vr-out-of-date",dismiss:!1}):this.triggerError_({code:"web-vr-not-supported",dismiss:!1}),this.options_.omnitone){var o=THREE.AudioContext.getContext();this.omniController=new OmnitoneController(o,this.options_.omnitone,this.getVideoEl_(),this.options_.omnitoneOptions),this.omniController.one("audiocontext-suspended",(function(){e.player.pause(),e.player.one("playing",(function(){o.resume()}))}))}this.on(this.player_,"fullscreenchange",this.handleResize_),window$1.addEventListener("vrdisplaypresentchange",this.handleResize_,!0),window$1.addEventListener("resize",this.handleResize_,!0),window$1.addEventListener("vrdisplayactivate",this.handleVrDisplayActivate_,!0),window$1.addEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_,!0),this.initialized_=!0,this.trigger("initialized")},i.addCardboardButton_=function(){this.player_.controlBar.getChild("CardboardButton")||this.player_.controlBar.addChild("CardboardButton",{})},i.getVideoEl_=function(){return this.player_.el().getElementsByTagName("video")[0]},i.reset=function(){if(this.initialized_){this.omniController&&(this.omniController.off("audiocontext-suspended"),this.omniController.dispose(),this.omniController=void 0),this.controls3d&&(this.controls3d.dispose(),this.controls3d=null),this.canvasPlayerControls&&(this.canvasPlayerControls.dispose(),this.canvasPlayerControls=null),this.effect&&(this.effect.dispose(),this.effect=null),window$1.removeEventListener("resize",this.handleResize_,!0),window$1.removeEventListener("vrdisplaypresentchange",this.handleResize_,!0),window$1.removeEventListener("vrdisplayactivate",this.handleVrDisplayActivate_,!0),window$1.removeEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_,!0),this.player_.getChild("BigPlayButton")||this.player_.addChild("BigPlayButton",{},this.bigPlayButtonIndex_),this.player_.getChild("BigVrPlayButton")&&this.player_.removeChild("BigVrPlayButton"),this.player_.getChild("CardboardButton")&&this.player_.controlBar.removeChild("CardboardButton"),videojs.browser.IS_IOS&&this.player_.controlBar&&this.player_.controlBar.fullscreenToggle&&this.player_.controlBar.fullscreenToggle.show();var e=this.getVideoEl_().style;e.zIndex="",e.opacity="",this.currentProjection_=this.defaultProjection_,this.iosRevertTouchToClick_&&this.iosRevertTouchToClick_(),this.renderedCanvas&&this.renderedCanvas.parentNode.removeChild(this.renderedCanvas),this.animationFrameId_&&this.cancelAnimationFrame(this.animationFrameId_),this.initialized_=!1}},i.dispose=function(){e.prototype.dispose.call(this),this.reset()},i.polyfillVersion=function(){return WebVRPolyfill.version},t}(Plugin);VR.prototype.setTimeout=Component.prototype.setTimeout,VR.prototype.clearTimeout=Component.prototype.clearTimeout,VR.VERSION=version,videojs.registerPlugin("vr",VR),module.exports=VR;
//# sourceMappingURL=/sm/db62e773c87d596ddd4deb2b918966f9a914ce93aa2e684698b89710b05d6407.map